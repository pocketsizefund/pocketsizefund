version = 1

[install]
gh.pkg-path = "gh"
pulumi.pkg-path = "pulumi"
pulumi-python.pkg-path = "pulumiPackages.pulumi-python"
ruff.pkg-path = "ruff"
ruff.version = "0.14.7"
uv.pkg-path = "uv"
vulture.pkg-path = "python313Packages.vulture"
yamllint.pkg-path = "yamllint"
nushell.pkg-path = "nushell"
fselect.pkg-path = "fselect"
awscli2.pkg-path = "awscli2"
gum.pkg-path = "gum"
mask.pkg-path = "mask"
bacon.pkg-path = "bacon"
cargo-watch.pkg-path = "cargo-watch"
cargo-nextest.pkg-path = "cargo-nextest"
cargo-tarpaulin.pkg-path = "cargo-tarpaulin"
cargo.pkg-path = "cargo"
cargo.pkg-group = "rust-toolchain"
rustc.pkg-path = "rustc"
rustc.pkg-group = "rust-toolchain"
clippy.pkg-path = "clippy"
clippy.pkg-group = "rust-toolchain"
rustfmt.pkg-path = "rustfmt"
rustfmt.pkg-group = "rust-toolchain"
rust-lib-src.pkg-path = "rustPlatform.rustLibSrc"
rust-lib-src.pkg-group = "rust-toolchain"
libiconv.pkg-path = "libiconv"
libiconv.systems = ["aarch64-darwin", "x86_64-darwin"]
rust-analyzer.pkg-path = "rust-analyzer"
rust-analyzer.pkg-group = "rust-analyzer"
gcc.pkg-path = "gcc"
gcc.systems = ["aarch64-linux", "x86_64-linux"]
clang.pkg-path = "clang"
clang.systems = ["aarch64-darwin", "x86_64-darwin"]
duckdb.pkg-path = "duckdb"
openssl.pkg-path = "openssl"
pkgconf.pkg-path = "pkgconf"
direnv.pkg-path = "direnv"

[hook]
on-activate = '''
if [[ -f .env ]]; then
  while IFS= read -r line || [[ -n "$line" ]]; do
    if [[ -z "${line// /}" ]]; then
      continue
    fi

    if [[ "$line" =~ ^[[:space:]]*# ]]; then
      continue
    fi

    line="${line%%[[:space:]]*#*}"

    if [[ "$line" =~ = ]]; then
      key="${line%%=*}"
      value="${line#*=}"

      key="${key#"${key%%[![:space:]]*}"}"  # trim leading
      key="${key%"${key##*[![:space:]]}"}"  # trim trailing

      if [[ "$key" =~ ^[a-zA-Z_][a-zA-Z0-9_]*$ ]]; then
        export "$key=$value"
      else
        echo "Skipping invalid key '$key' in .env" >&2
      fi
    fi
  done < .env
else
  echo ".env file not found, skipping environment variable loading" >&2
fi
'''

[build]

[options]
systems = ["aarch64-darwin", "aarch64-linux", "x86_64-darwin", "x86_64-linux"]
