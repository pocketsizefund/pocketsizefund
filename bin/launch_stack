#!/usr/bin/env bash

# launch Kubernetes resources

set -e

location=${1:-"remote"}

environment=${2:-"development"}

# NOTE: potentially add in conditional cluster creation here

if [[ $location == "local" ]]; then
    minikube start
    minikube image load image pocketsizefund-${environment}-price-model:latest
    minikube image load image pocketsizefund-${environment}-position-manager:latest
else
    account_region=$(aws --profile default configure get region)

    aws eks update-kubeconfig \
        --region ${account_region} \
        --name pocketsizefund-platform
fi

sed 's/{ENVIRONMENT}/'${environment}'/g' platform.yaml | kubectl create --filename -
