[tasks."python:install"]
description = "Install Python dependencies"
run = "uv sync --all-groups"

[tasks."python:format"]
description = "Format Python code"
run = "ruff format"

[tasks."python:dead-code"]
depends = ["python:format"]
description = "Check for dead Python code"
run = """
vulture \
    --min-confidence 80 \
    --exclude '.flox,.venv,target' \
    .
"""

[tasks."python:lint"]
depends = ["python:dead-code"]
description = "Run Python code quality checks"
run = """
ruff check \
    --output-format=github \
    .
"""

[tasks."python:test"]
description = "Run Python tests"
run = "docker compose run tests"

[tasks."application:service:build"]
description = "Build the application service"
run = """
TIMESTAMP=$(date +%Y%m%d) 
docker build \
--file application/{{arg(name="service_name")}}/Dockerfile \
--tag pocketsizefund/{{arg(name="service_name")}}:latest \
--tag pocketsizefund/{{arg(name="service_name")}}:${TIMESTAMP} \
.
"""

[tasks."application:service:run"]
description = "Run the application service"
run = """
docker run \
--env-file .env \
--publish 8080:8080 \
pocketsizefund/{{arg(name="service_name")}}:latest \
"""


[tasks."lint"]
depends = ["python:lint"]
description = "Run code quality checks"
run = """
yamllint .
"""

[tasks."infrastructure:up"]
description = "launch cloud infrastructure"
run = """
cd infrastructure
uv run pulumi up --yes
"""
